<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>My Time</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: "Segoe UI", Arial;
      background: linear-gradient(135deg, #667eea, #764ba2);
      padding: 20px;
      color: #333;
    }
    .card {
      max-width: 420px;
      margin: auto;
      background: #ffffff;
      padding: 20px;
      border-radius: 14px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      margin-bottom: 20px;
    }
    h2, h3 {
      text-align: center;
      color: #4a4a4a;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 15px;
    }
    button {
      background: #667eea;
      color: #fff;
      border: none;
      font-weight: bold;
    }
    button.secondary {
      background: #764ba2;
    }
    ul {
      padding: 0;
    }
    li {
      list-style: none;
      background: #f3f4f6;
      padding: 8px;
      border-radius: 6px;
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .hidden {
      display: none;
    }
    .hour {
      font-weight: bold;
      margin-top: 8px;
    }
  </style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox" class="card">
  <h2>My Time</h2>
  <input id="password" type="password" placeholder="Enter password">
  <button id="loginBtn">Login</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="card hidden">
  <h3>Dashboard</h3>
  <button onclick="showTasks()">Tasks</button>
  <button class="secondary" onclick="showTimetable()">Timetable</button>
</div>

<!-- TASKS -->
<div id="tasksScreen" class="card hidden">
  <h3>Tasks</h3>
  <input type="date" id="taskDate">
  <input id="taskInput" placeholder="New task">
  <button onclick="addTask()">Add Task</button>
  <ul id="taskList"></ul>
  <button class="secondary" onclick="goBack()">Back</button>
</div>

<!-- TIMETABLE -->
<div id="timetableScreen" class="card hidden">
  <h3>Timetable</h3>
  <input type="date" id="timetableDate">
  <div id="timeBlocks"></div>
  <button onclick="saveTimetable()">Save Timetable</button>
  <button class="secondary" onclick="goBack()">Back</button>
</div>

<script>
const API = "https://my-time-backend.onrender.com";

const loginBox = document.getElementById("loginBox");
const dashboard = document.getElementById("dashboard");
const tasksScreen = document.getElementById("tasksScreen");
const timetableScreen = document.getElementById("timetableScreen");

document.getElementById("loginBtn").onclick = () => {
  fetch(API + "/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ password: password.value })
  })
  .then(r => {
    if (!r.ok) throw new Error("Wrong password");
    return r.json();
  })
  .then(() => {
    loginBox.classList.add("hidden");
    dashboard.classList.remove("hidden");
  })
  .catch(e => alert(e.message));
};

function showTasks() {
  dashboard.classList.add("hidden");
  tasksScreen.classList.remove("hidden");
  taskDate.valueAsDate = new Date();
  loadTasks();
}

function showTimetable() {
  dashboard.classList.add("hidden");
  timetableScreen.classList.remove("hidden");
  timetableDate.valueAsDate = new Date();
  loadTimetable();
}

function goBack() {
  tasksScreen.classList.add("hidden");
  timetableScreen.classList.add("hidden");
  dashboard.classList.remove("hidden");
}

/* TASKS */
taskDate.onchange = loadTasks;

function loadTasks() {
  fetch(API + "/tasks?date=" + taskDate.value)
    .then(r => r.json())
    .then(data => {
      taskList.innerHTML = "";
      data.forEach(t => {
        let li = document.createElement("li");
        li.innerHTML = `${t.text} <button onclick="completeTask('${t._id}')">âœ”</button>`;
        taskList.appendChild(li);
      });
    });
}

function addTask() {
  fetch(API + "/tasks", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text: taskInput.value, date: taskDate.value })
  }).then(() => {
    taskInput.value = "";
    loadTasks();
  });
}

function completeTask(id) {
  fetch(API + "/tasks/" + id, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ completed: true })
  }).then(loadTasks);
}

/* TIMETABLE */
timetableDate.onchange = loadTimetable;

function loadTimetable() {
  fetch(API + "/timetable?date=" + timetableDate.value)
    .then(r => r.json())
    .then(data => {
      timeBlocks.innerHTML = "";
      for (let i = 6; i <= 22; i++) {
        let hour = i + ":00";
        let saved = data.find(b => b.hour === hour);
        timeBlocks.innerHTML += `
          <div class="hour">${hour}</div>
          <input data-hour="${hour}" value="${saved ? saved.text : ""}">
        `;
      }
    });
}

function saveTimetable() {
  let blocks = [];
  document.querySelectorAll("#timeBlocks input").forEach(i => {
    blocks.push({
      hour: i.dataset.hour,
      text: i.value,
      date: timetableDate.value
    });
  });

  fetch(API + "/timetable", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ date: timetableDate.value, blocks })
  }).then(() => alert("Timetable saved"));
}
</script>

</body>
</html>
