<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Time</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --primary:#6a5acd;
  --accent:#00c9a7;
  --bg:#f4f6fb;
  --card:#ffffff;
  --muted:#6b7280;
  --border:#e5e7eb;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Inter,system-ui,Segoe UI,Roboto;
  background:var(--bg);
  padding:12px;
}

.card{
  max-width:1100px;
  margin:auto;
  background:var(--card);
  border-radius:24px;
  padding:18px;
  box-shadow:0 20px 45px rgba(0,0,0,.12);
}

h2{
  text-align:center;
  margin:0 0 12px;
}

button{
  border:none;
  border-radius:16px;
  padding:12px 16px;
  font-weight:600;
  cursor:pointer;
  font-size:14px;
}

.btn{background:var(--primary);color:white}
.btn-light{background:#eef0ff}

.topbar{
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:10px;
}

.topbar input{
  flex:1;
  padding:12px;
  border-radius:14px;
  border:1px solid var(--border);
}

.week{
  display:flex;
  gap:6px;
  margin-bottom:12px;
}

.week div{
  flex:1;
  padding:10px 0;
  text-align:center;
  border-radius:14px;
  background:#f1f2f6;
  font-size:13px;
  cursor:pointer;
}

.week .active{
  background:var(--primary);
  color:white;
}

.controls{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
  margin-bottom:12px;
}

select{
  padding:12px;
  border-radius:14px;
  border:1px solid var(--border);
}

.block{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
  padding:14px;
  border-radius:18px;
  background:#f9fafb;
  margin-bottom:10px;
}

.block.done{background:rgba(0,201,167,.15)}

.block textarea{
  grid-column:1/3;
  resize:vertical;
  min-height:42px;
  border-radius:12px;
  border:1px solid var(--border);
  padding:10px;
}

.block .actions{
  grid-column:1/3;
  display:flex;
  gap:8px;
}

.block input[type=time]{
  padding:10px;
  border-radius:12px;
  border:1px solid var(--border);
}

.time-preview{
  font-size:12px;
  color:var(--muted);
  margin-top:2px;
}

footer{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
  margin-top:14px;
}

@media(min-width:768px){
  .block{
    grid-template-columns:110px 110px 1fr 120px;
    align-items:center;
  }
  .block textarea{grid-column:auto}
  .block .actions{grid-column:auto}
}
</style>
</head>

<body>

<div class="card">
  <h2>My Time</h2>

  <div class="topbar">
    <button class="btn-light" onclick="changeDay(-1)">◀</button>
    <input type="date" id="date">
    <button class="btn-light" onclick="changeDay(1)">▶</button>
  </div>

  <div class="week" id="week"></div>

  <div class="controls">
    <select id="gap">
      <option value="1">1h gap</option>
      <option value="2" selected>2h gap</option>
      <option value="3">3h gap</option>
    </select>
    <button class="btn" onclick="generate()">Generate Day</button>
    <button class="btn-light" onclick="copyYesterday()">Copy Yesterday</button>
    <button class="btn-light" onclick="addRow()">Add Row</button>
  </div>

  <div id="blocks"></div>

  <footer>
    <button class="btn" onclick="backup()">Backup</button>
    <button class="btn-light" onclick="restore()">Restore</button>
    <input type="file" id="file" hidden>
  </footer>
</div>

<script>
const dateEl=document.getElementById("date");
const blocksEl=document.getElementById("blocks");
dateEl.value=new Date().toISOString().split("T")[0];
const days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

function store(d){localStorage.setItem("myTimeFinal",JSON.stringify(d))}
function loadStore(){return JSON.parse(localStorage.getItem("myTimeFinal")||"{}")}

function toAMPM(t){
  let [h,m]=t.split(":").map(Number);
  const a=h>=12?"PM":"AM";
  h=h%12||12;
  return h+":"+m.toString().padStart(2,"0")+" "+a;
}

function buildWeek(){
  const w=document.getElementById("week");
  w.innerHTML="";
  const base=new Date(dateEl.value);
  for(let i=0;i<7;i++){
    const d=new Date(base);
    d.setDate(base.getDate()-base.getDay()+i);
    const div=document.createElement("div");
    div.textContent=days[i];
    if(d.toISOString().slice(0,10)===dateEl.value)div.classList.add("active");
    div.onclick=()=>{dateEl.value=d.toISOString().slice(0,10);render();}
    w.appendChild(div);
  }
}

function changeDay(n){
  const d=new Date(dateEl.value);
  d.setDate(d.getDate()+n);
  dateEl.value=d.toISOString().slice(0,10);
  render();
}

function generate(){
  const gap=+document.getElementById("gap").value;
  const all=loadStore();
  const rows=[];
  for(let h=0;h<24;h+=gap){
    rows.push({
      start:(h+"").padStart(2,"0")+":00",
      end:((h+gap)%24+"").padStart(2,"0")+":00",
      text:"",
      done:false
    });
  }
  all[dateEl.value]=rows;
  store(all);render();
}

function copyYesterday(){
  const all=loadStore();
  const d=new Date(dateEl.value);
  d.setDate(d.getDate()-1);
  const y=d.toISOString().slice(0,10);
  if(!all[y])return alert("No data for yesterday");
  all[dateEl.value]=JSON.parse(JSON.stringify(all[y]));
  store(all);render();
}

function addRow(){
  const all=loadStore();
  all[dateEl.value] ||= [];
  all[dateEl.value].push({start:"00:00",end:"01:00",text:"",done:false});
  store(all);render();
}

function render(){
  blocksEl.innerHTML="";
  buildWeek();
  const day=loadStore()[dateEl.value]||[];
  day.forEach((b,i)=>{
    const div=document.createElement("div");
    div.className="block"+(b.done?" done":"");
    div.innerHTML=`
      <div>
        <input type="time" value="${b.start}" onchange="edit(${i},'start',this.value)">
        <div class="time-preview">${toAMPM(b.start)}</div>
      </div>
      <div>
        <input type="time" value="${b.end}" onchange="edit(${i},'end',this.value)">
        <div class="time-preview">${toAMPM(b.end)}</div>
      </div>
      <textarea onchange="edit(${i},'text',this.value)">${b.text}</textarea>
      <div class="actions">
        <button onclick="toggle(${i})">✔</button>
        <button onclick="removeRow(${i})">✕</button>
      </div>
    `;
    blocksEl.appendChild(div);
  });
}

function edit(i,k,v){
  const all=loadStore();
  all[dateEl.value][i][k]=v;
  store(all);
}

function toggle(i){
  const all=loadStore();
  all[dateEl.value][i].done=!all[dateEl.value][i].done;
  store(all);render();
}

function removeRow(i){
  const all=loadStore();
  all[dateEl.value].splice(i,1);
  store(all);render();
}

function backup(){
  const d=localStorage.getItem("myTimeFinal");
  if(!d)return alert("No data");
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([d]));
  a.download="my-time-backup.json";
  a.click();
}

function restore(){
  document.getElementById("file").click();
}
document.getElementById("file").onchange=e=>{
  const f=e.target.files[0];
  if(!f)return;
  const r=new FileReader();
  r.onload=()=>{store(JSON.parse(r.result));render();}
  r.readAsText(f);
};

dateEl.onchange=render;
render();
</script>

</body>
</html>
