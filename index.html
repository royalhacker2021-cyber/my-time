<!DOCTYPE html>
<html>
<head>
  <title>My Time</title>  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial; background:#f6f7f9; padding:20px; }
    .box { max-width:400px; margin:auto; background:#fff; padding:20px; border-radius:8px; }
    h2 { text-align:center; }
    input, button { width:100%; padding:10px; margin-top:10px; }
    ul { padding:0; }
    li { list-style:none; padding:8px; border-bottom:1px solid #ddd; }
    button { background:#000; color:#fff; border:none; }
  </style>
</head>
<body>

<div class="box" id="loginBox">
  <h2>My Time</h2>
  <input type="password" id="password" placeholder="Enter password">
  <button onclick="login()">Login</button>
</div>

<div class="box" id="appBox" style="display:none">
  <h3>ğŸ“… Select Date</h3>
  <input type="date" id="datePicker" />

  <h3>ğŸ“ Tasks</h3>
  <input id="taskInput" placeholder="New task">
  <button onclick="addTask()">Add</button>

  <ul id="tasks"></ul>

  <button onclick="loadHistory()">ğŸ“‚ View Completed Tasks</button>
  <ul id="history"></ul>
</div>


<script>
const API = "https://my-time-backend.onrender.com";

function login() {
  fetch(API + "/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ password: password.value })
  })
  .then(res => res.json().then(data => {
    if (!res.ok) throw new Error(data.error || "Login failed");
    return data;
  }))
  .then(() => {
    loginBox.style.display = "none";
    appBox.style.display = "block";
    datePicker.valueAsDate = new Date();
    loadTasks();
  })
  .catch(err => alert(err.message));
}


function loadTasks(){
  fetch(API + "/tasks?date=" + datePicker.value)
    .then(r=>r.json())
    .then(data=>{
      tasks.innerHTML="";
      data.forEach(t=>{
        let li=document.createElement("li");
        li.innerHTML = `${t.text} <button onclick="completeTask('${t._id}')">âœ”</button>`;
        tasks.appendChild(li);
      })
    })
}

datePicker.onchange = loadTasks;

function addTask(){
  fetch(API+"/tasks",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      text: taskInput.value,
      date: datePicker.value
    })
  }).then(()=>{
    taskInput.value="";
    loadTasks();
  })
}

function completeTask(id){
  fetch(API+"/tasks/"+id,{
    method:"PUT",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ completed:true })
  }).then(loadTasks)
}

function loadHistory(){
  fetch(API+"/history")
    .then(r=>r.json())
    .then(data=>{
      history.innerHTML="";
      data.forEach(t=>{
        let li=document.createElement("li");
        li.textContent = `${t.text} (${t.date})`;
        history.appendChild(li);
      })
    })
}

