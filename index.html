<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Time</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --primary:#6a5acd;
  --bg:#f4f6fb;
  --card:#ffffff;
  --muted:#6b7280;
  --done:#00c9a7;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto,Arial;
  background:var(--bg);
  padding:16px;
}

.card{
  max-width:900px;
  margin:auto;
  background:var(--card);
  border-radius:20px;
  padding:20px;
  box-shadow:0 10px 25px rgba(0,0,0,.12);
}

h2{
  text-align:center;
  margin:0 0 16px;
}

label{
  font-size:13px;
  color:var(--muted);
  font-weight:600;
}

input,textarea,button{
  font-size:14px;
}

input,textarea{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:1px solid #ddd;
}

textarea{
  resize:vertical;
  min-height:42px;
}

button{
  border:none;
  border-radius:12px;
  padding:12px;
  cursor:pointer;
  font-weight:600;
}

.btn{
  background:var(--primary);
  color:white;
  width:100%;
  margin-top:10px;
}

.row{
  display:flex;
  gap:10px;
  margin-bottom:10px;
}
.row>div{flex:1}

.block{
  background:#f9fafb;
  border-radius:16px;
  padding:12px;
  margin-bottom:10px;
  display:flex;
  gap:10px;
  align-items:flex-start;
}

.block.done{
  background:rgba(0,201,167,.15);
}

.time{
  width:90px;
  font-weight:600;
  white-space:nowrap;
}

.actions{
  display:flex;
  flex-direction:column;
  gap:6px;
}

.small{
  font-size:12px;
  padding:6px 10px;
}
</style>
</head>

<body>

<div class="card">
  <h2>My Time</h2>

  <label>Date</label>
  <input type="date" id="date">

  <hr style="margin:16px 0">

  <label>Add Time Block</label>
  <div class="row">
    <div><input type="time" id="start"></div>
    <div><input type="time" id="end"></div>
  </div>
  <textarea id="text" placeholder="What will you do?"></textarea>
  <button class="btn" onclick="addBlock()">Add Block</button>

  <hr style="margin:16px 0">

  <div id="blocks"></div>
  
  <hr style="margin:16px 0">

<button class="btn" onclick="backupData()">Backup Data</button>
<button class="btn" style="background:#444;margin-top:8px" onclick="restoreData()">Restore Data</button>

<input type="file" id="restoreFile" accept=".json" hidden>

</div>

<script>
const dateInput = document.getElementById("date");
const blocksDiv = document.getElementById("blocks");

dateInput.value = new Date().toISOString().split("T")[0];

// ---------- LOCAL STORAGE ----------
function getData(){
  return JSON.parse(localStorage.getItem("myTimeOffline") || "{}");
}
function setData(d){
  localStorage.setItem("myTimeOffline", JSON.stringify(d));
}

// ---------- LOAD DAY ----------
function load(){
  blocksDiv.innerHTML="";
  const data = getData()[dateInput.value] || [];

  data.forEach((b,i)=>{
    const div = document.createElement("div");
    div.className = "block" + (b.done?" done":"");

    div.innerHTML = `
      <div class="time">${b.start}–${b.end}</div>
      <textarea onchange="editText(${i},this.value)">${b.text}</textarea>
      <div class="actions">
        <button class="small" onclick="toggleDone(${i})">✔</button>
        <button class="small" onclick="removeBlock(${i})">✕</button>
      </div>
    `;
    blocksDiv.appendChild(div);
  });
}

// ---------- ADD BLOCK ----------
function addBlock(){
  if(!start.value || !end.value){
    alert("Select start and end time");
    return;
  }

  const all = getData();
  all[dateInput.value] ||= [];

  all[dateInput.value].push({
    start:start.value,
    end:end.value,
    text:text.value,
    done:false
  });

  setData(all);
  text.value="";
  load();
}

// ---------- TOGGLE DONE ----------
function toggleDone(i){
  const all = getData();
  all[dateInput.value][i].done = !all[dateInput.value][i].done;
  setData(all);
  load();
}

// ---------- EDIT TEXT ----------
function editText(i,val){
  const all = getData();
  all[dateInput.value][i].text = val;
  setData(all);
}

// ---------- REMOVE ----------
function removeBlock(i){
  const all = getData();
  all[dateInput.value].splice(i,1);
  setData(all);
  load();
}

dateInput.onchange = load;
load();
  // ---------- BACKUP ----------
function backupData(){
  const data = localStorage.getItem("myTimeOffline");
  if(!data){
    alert("No data to backup");
    return;
  }

  const blob = new Blob([data], { type: "application/json" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "my-time-backup.json";
  a.click();

  URL.revokeObjectURL(url);
}

// ---------- RESTORE ----------
function restoreData(){
  document.getElementById("restoreFile").click();
}

document.getElementById("restoreFile").addEventListener("change", e=>{
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    try{
      const data = JSON.parse(reader.result);
      localStorage.setItem("myTimeOffline", JSON.stringify(data));
      alert("Data restored successfully ✔");
      load();
    }catch{
      alert("Invalid backup file");
    }
  };
  reader.readAsText(file);
});

</script>

</body>
</html>
