<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>My Time</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family:Arial;background:linear-gradient(135deg,#43cea2,#185a9d);padding:20px }
.card { max-width:900px;margin:auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,.15);margin-bottom:20px }
h2,h3{text-align:center}
button{border:none;border-radius:6px;cursor:pointer}
.btn{background:#185a9d;color:#fff;width:100%;padding:10px;margin-top:10px}
.btn-secondary{background:#6c757d;color:#fff;width:100%;padding:8px;margin-top:6px}
.btn-green{background:#2ecc71;color:#fff;padding:6px 10px;margin-left:6px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:6px}
textarea{width:100%;min-height:40px}
.hidden{display:none}
.done{background:#d4edda;text-decoration:line-through}
.row{display:flex;gap:10px;flex-wrap:wrap}
.row>div{flex:1}
.streak{font-size:18px;text-align:center;margin-top:10px}
</style>
</head>

<body>

<div id="loginBox" class="card">
  <h2>My Time</h2>
  <input id="passwordInput" type="password" placeholder="Enter password">
  <button class="btn" id="loginBtn">Login</button>
</div>

<div id="dashboard" class="card hidden">
  <h3>Dashboard</h3>
  <div id="streakBox" class="streak"></div>
  <button class="btn" onclick="openTimetable()">Timetable</button>
  <button class="btn-secondary" onclick="openWeekly()">Weekly Report</button>
</div>

<div id="timetableScreen" class="card hidden">
  <h3>Daily Timetable</h3>

  <input type="date" id="ttDate">
  <button class="btn" onclick="build()">Build</button>

  <table id="ttTable">
    <thead><tr><th>Time</th><th>Task</th></tr></thead>
    <tbody></tbody>
  </table>

  <button class="btn" onclick="save()">Save</button>
  <button class="btn" onclick="back()">Back</button>
</div>

<div id="weeklyScreen" class="card hidden">
  <h3>Weekly Report</h3>
  <div id="weeklySummary"></div>
  <button class="btn" onclick="back()">Back</button>
</div>

<script>
const API="https://my-time-backend.onrender.com";

loginBtn.onclick=async()=>{
  const r=await fetch(API+"/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:passwordInput.value})});
  if(!r.ok)return alert("Wrong password");
  loginBox.classList.add("hidden");
  dashboard.classList.remove("hidden");
  loadStreak();
};

function back(){
  timetableScreen.classList.add("hidden");
  weeklyScreen.classList.add("hidden");
  dashboard.classList.remove("hidden");
  loadStreak();
}

function openTimetable(){
  dashboard.classList.add("hidden");
  timetableScreen.classList.remove("hidden");
  ttDate.value=new Date().toISOString().split("T")[0];
  build();
}

function build(){
  const tb=ttTable.querySelector("tbody");
  tb.innerHTML="";
  for(let i=5;i<23;i++){
    tb.innerHTML+=`
      <tr>
        <td>${i}:00</td>
        <td>
          <textarea data-key="${i}"></textarea>
          <button class="btn-green" onclick="this.parentElement.classList.toggle('done')">‚úî</button>
        </td>
      </tr>`;
  }
  load();
}

async function save(){
  const blocks=[];
  document.querySelectorAll("textarea").forEach(t=>{
    blocks.push({hour:t.dataset.key,text:t.value,completed:t.parentElement.classList.contains("done")});
  });
  await fetch(API+"/timetable",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:ttDate.value,blocks})});
  alert("Saved");
}

async function load(){
  const r=await fetch(API+"/timetable?date="+ttDate.value);
  const d=await r.json();
  document.querySelectorAll("textarea").forEach(t=>{
    const f=d.find(b=>b.hour===t.dataset.key);
    if(f){
      t.value=f.text;
      t.parentElement.classList.toggle("done",f.completed);
    }
  });
}

function openWeekly(){
  dashboard.classList.add("hidden");
  weeklyScreen.classList.remove("hidden");
  weeklySummary.innerHTML="Weekly logic already implemented earlier ‚úî";
}

async function loadStreak(){
  const r=await fetch(API+"/streak");
  const s=await r.json();
  streakBox.innerHTML=`üî• Current Streak: <b>${s.current}</b> days<br>üèÜ Best Streak: <b>${s.best}</b> days`;
}
</script>

</body>
</html>
